import pygame
from pygame.locals import *
import Image
import pytesseract
import serial
import time

def detect_text(path):
    pytesseract.pytesseract.tesseract_cmd = ''
    return pytesseract.image_to_string(Image.open(path))

'''
char dict for reference
    chars = {
    'A':['01110', '01010', '01110', '01010', '01010'],
    'B':['11100', '10100', '11100', '10100', '11100'],
    'C':['11111', '10000', '10000', '10000', '11111'],
    'D':['11110', '10001', '10001', '10001', '11110'],
    'E':['11110', '10000', '11110', '10000', '11110'],
    'F':['11110', '10000', '11110', '10000', '10000'],
    'G':['11111', '10000', '10011', '10001', '11111'],
    'H':['10001', '10001', '11111', '10001', '10001'],
    'I':['11111', '00100', '00100', '00100', '11111'],
    'J':['11111', '00100', '00100', '00100', '11100'],
    'K':['10010', '10100', '11000', '10100', '10010'],
    'L':['10000', '10000', '10000', '10000', '11111'],
    'M':['11111', '10101', '10101', '10101', '10001'],
    'N':['11111', '10001', '10001', '10001', '10001'],
    'O':['11111', '10001', '10001', '10001', '11111'],
    'P':['11111', '10001', '11111', '10000', '10000'],
    'Q':['11111', '10001', '10001', '11111', '00100'],
    'R':['11111', '10001', '11111', '11000', '10100'],
    'S':['11111', '10000', '11111', '00001', '11111'],
    'T':['11111', '00100', '00100', '00100', '00100'],
    'U':['10001', '10001', '10001', '10001', '11111'],
    'V':['10001', '10001', '01010', '01010', '00100'],
    'W':['10001', '10001', '10101', '01010', '01010'],
    'X':['10001', '01010', '00100', '01010', '10001'],
    'Y':['10001', '01010', '00100', '00100', '00100'],
    'Z':['11111', '00010', '00100', '01000', '11111']
    }
'''

def getCharBytes(ch):
    #dict of hex strings of coords of 0th layer
    #2-dig coords
    coords = []
    dict{
	'A': '08101830405860688090a8b8',
	'B': '00081028385058607888a0a8b0',
	'C': '0008101820285078a0a8b0b8c0',
	'D': '00081018284850707898a0a8b0b8',
	'E': '00081018285058606878a0a8b0b8',
	'F': '00081018285058606878a0',
	'G': '0008101820285068707898a0a8b0b8c0',
	'H': '0020284850586068707898a0c0',
	'I': '0008101820386088a0a8b0b8c0',
	'J': '0008101820386088a0a8b0',
	'K': '0018283850587888a0b8',
	'L': '00285078a0a8b0b8c0',
	'M': '0008101820283848506070788898a0c0',
	'N': '0008101820284850707898a0c0',
	'O': '0008101820284850707898a0a8b0b8c0',
	'P': '00081018202848505860687078a0',
	'Q': '0008101820284850707880889098b0',
	'R': '0008101820284850586068707880a0b0',
	'S': '000810182028505860687098a0a8b0b8c0',
	'T': '0008101820386088b0',
	'U': '0020284850707898a0a8b0b8c0',
	'V': '0020284858688090b0',
	'W': '002028485060708090a8b8',
	'X': '00203040608090a0c0',
	'Y': '002030406088b0',
	'Z': '0008101820406080a0a8b0b8c0',
    }
    if(ch in dict.keys()):
        coord = dict[ch]
        for i in range(5):
            for j in range(0, len(coord), 2):
                coords.append(int(coord[j:j+2], 16)+i)
        return coords
    else:
        return []

pygame.init()
cameras = list_cameras()
if(cameras):
  cam = Camera(cameras[0], cameras[0].get_size())
cam.start()

while(True):
    img = cam.get_image()
    pygame.image.save(img, 'image.jpg')
    detected = detect_text('image.jpg')
    print detected
